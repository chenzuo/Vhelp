@model VideoHelp.ReadModel.Users.UserView

@{ ViewBag.Title = "Ticket Sales"; }




<h1>Event Tickets</h1>
<div id="TicketSummary">
    @{
        Write(@Model.Id + " " + @Model.FullName);
    };

    <div data-bind="text:Available, css:{ ImportantMessage: StockIsLow }" class="TicketCount"></div>
    <div class="Hidden ImportantMessage" data-bind="css: { Hidden: !StockIsLow() }">
        Event is almost sold out!</div>
    <button data-bind="click: BuyTicket, enable: CanBuyTicket">Buy a Ticket</button>
</div>


@*
<script src="@Url.Content("~/Scripts/json2.min.js")" type="text/javascript"></script>
<script src="@Url.Content("~/Scripts/jquery.signalr.min.js")" type="text/javascript"></script>
<script src="@Url.Content("~/Scripts/knockout.js")" type="text/javascript"></script>
<script type="text/javascript" src="/signalr/hubs"></script>






<script type="text/javascript">
    
    var ticketDataViewModel = {
        Available: ko.observable(),
        BuyTicket: function () { tickets.buyTicket(); }
    };

    ticketDataViewModel.StockIsLow = ko.dependentObservable(function () {
        return this.Available() < 5 && this.Available() > 0;
    }, ticketDataViewModel);

    ticketDataViewModel.CanBuyTicket = ko.dependentObservable(function () {
        return this.Available() > 0;
    }, ticketDataViewModel);

    ko.applyBindings(ticketDataViewModel, $("#TicketSummary")[0]);

    var tickets;
    $(function () {
        tickets = $.connection.ticketHub;
        tickets.updateTicketCount = function (data) { ticketDataViewModel.Available(data); };
        tickets.addMessage = function (msg) { alert(msg); };
        $.connection.hub.start(function () { tickets.getTicketCount(); });
    });
</script>*@